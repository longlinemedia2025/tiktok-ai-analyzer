<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TikTok & YouTube Viral Optimizer</title>
  <style>
    :root{
      --tiktok-a: #00f2ea;
      --tiktok-b: #ff0066;
      --yt-a: #ff0000;
      --yt-b: #ff6a00;
      --ig-a: #feda75;
      --ig-b: #d62976;
      --text: #f5f5f5;
      --muted: #aaa;
      --bg-default: linear-gradient(-45deg,#0b0b0b,#141414,#1a1a1a,#0b0b0b);
    }

    html,body{height:100%; margin:0;}
    body{
      font-family: "Inter", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg-default);
      background-size:400% 400%;
      animation: gradientFlow 15s ease infinite;
      color:var(--text);
      text-align:center;
      padding:40px 20px;
      transition: background 1.2s ease-in-out,color .6s;
      overflow-y:auto;
      position:relative;
    }
    @keyframes gradientFlow {
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }

    /* UI elements (kept identical to your last approved layout) */
    #logo { width:110px; margin-bottom:20px; filter: drop-shadow(0 0 15px rgba(255,255,255,0.12)); position:relative; z-index:3; }
    h1 { font-size:2.2rem; margin-bottom:1.2rem; color:var(--tiktok-a); text-shadow:0 0 8px rgba(0,242,234,0.35); z-index:3; position:relative; }
    .upload-container{ border:2px dashed #333; border-radius:16px; padding:26px; margin:18px auto; width:80%; max-width:640px; background:rgba(20,20,20,0.9); transition:.25s; z-index:3; position:relative; }
    .upload-hint{ margin:0; color:var(--muted); }
    .file-meta{ margin-top:10px; color:#ccc; font-size:0.95rem; }
    input[type=file]{ display:none; }
    label{ cursor:pointer; color:var(--tiktok-a); font-weight:700; display:inline-block; margin-top:10px; z-index:3; }
    label:hover{ opacity:.95; }
    button{ background:var(--tiktok-a); border:none; color:#000; padding:12px 26px; border-radius:12px; cursor:pointer; font-size:1rem; transition:transform .14s,box-shadow .14s; margin-top:20px; font-weight:800; box-shadow:0 6px 20px rgba(0,242,234,0.12); z-index:3; position:relative; }
    button:hover{ transform:translateY(-2px); }
    select{ background:#141414; color:#fff; border:1px solid #333; border-radius:8px; padding:8px 12px; font-size:1rem; margin-bottom:15px; outline:none; z-index:3; position:relative; }

    #results{ margin-top:26px; white-space:pre-wrap; background:rgba(20,20,20,0.96); border-radius:14px; padding:22px; width:85%; max-width:860px; margin-left:auto; margin-right:auto; text-align:left; line-height:1.6; box-shadow:0 6px 40px rgba(0,0,0,0.6); z-index:3; position:relative; }
    .detected-section{ margin-top:18px; text-align:left; width:85%; max-width:750px; margin-left:auto; margin-right:auto; background:rgba(26,26,26,0.95); border-radius:12px; padding:18px; opacity:0; transition:opacity .5s; box-shadow:0 6px 30px rgba(0,0,0,0.6); z-index:3; position:relative; }
    .detected-section.visible{ opacity:1; }
    .detected-section h3{ margin-top:0; color:var(--tiktok-a); }

    /* Loader & progress area */
    .loader{ display:none; margin:18px auto 6px; text-align:center; width:90%; max-width:700px; position:relative; z-index:3; }
    .status-feed{ margin:12px 0 6px; color:var(--muted); min-height:26px; font-size:0.98rem; }
    .progress-wrap{ width:70%; max-width:560px; height:12px; background:rgba(255,255,255,0.06); border-radius:999px; margin:16px auto 0; overflow:hidden; position:relative; z-index:3; }
    .progress{ height:100%; width:0%; background:linear-gradient(90deg, rgba(255,255,255,0.4), rgba(255,255,255,0.08)); border-radius:999px; transition:width 300ms linear; box-shadow:0 6px 18px rgba(0,0,0,0.5) inset; }
    .progress-bar-glow{ position:absolute; left:-40%; top:-40%; width:180%; height:180%; background:linear-gradient(90deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02)); filter:blur(20px); pointer-events:none; opacity:.6; transition:opacity 200ms; }

    .dots{ margin-top:10px; }
    .dot{ height:10px; width:10px; margin:0 6px; display:inline-block; border-radius:50%; background:var(--tiktok-a); opacity:.95; }

    #reset-btn{ display:none; margin-top:14px; background:#333; color:#fff; padding:8px 14px; border-radius:8px; border:none; cursor:pointer; z-index:3; }

    /* platform colors override */
    body.youtube-mode h1{ color:var(--yt-a); text-shadow:0 0 10px rgba(255,0,0,0.25); }
    body.youtube-mode label{ color:var(--yt-a); }
    body.youtube-mode button{ background:linear-gradient(90deg,var(--yt-a),var(--yt-b)); color:#fff; box-shadow:0 8px 30px rgba(255,0,0,0.12); }
    body.youtube-mode .dot{ background:var(--yt-a); }
    body.youtube-mode .detected-section h3{ color:var(--yt-a); }

    body.instagram-mode h1{ color:var(--ig-b); text-shadow:0 0 10px rgba(214,41,118,0.25); }
    body.instagram-mode label{ color:var(--ig-b); }
    body.instagram-mode button{ background:linear-gradient(90deg,var(--ig-a),var(--ig-b)); color:#000; box-shadow:0 8px 30px rgba(214,41,118,0.08); }
    body.instagram-mode .dot{ background:linear-gradient(90deg,var(--ig-a),var(--ig-b)); }
    body.instagram-mode .detected-section h3{ color:var(--ig-b); }

    /* ================
       SVG Metaballs background (full-screen)
       - The SVG contains circle elements inside a grouped <g>.
       - The group is fed through a blur + color-matrix filter to achieve threshold merging.
       - JS moves the circles by animating their cx/cy via requestAnimationFrame for smooth control
       ================ */
    .metaball-svg {
      position: fixed;
      inset: 0;
      width:100%;
      height:100%;
      z-index:-1;    /* behind everything */
      pointer-events:none;
    }

    /* Small tweak: ensure the SVG scales without adding scrollbars */
    svg.metaball-svg { width:100%; height:100%; display:block; }

    /* fade-in for SVG group so blobs appear smoothly */
    .metagroup { opacity:0; transition:opacity 1s ease; }
    .metagroup.visible { opacity:1; }

    /* make blobs slightly neon by increasing fill-opacity */
    .metaball { fill-opacity:0.95; }
  </style>
</head>
<body class="tiktok-mode">
  <!-- ================
       SVG Metaballs (true gooey / merging)
       - 15 circles are generated in markup to make them selectable from CSS/JS
       - filter 'metablur' blurs then thresholds via colorMatrix for gooey merging
       ================ -->
  <svg class="metaball-svg" viewBox="0 0 1920 1080" preserveAspectRatio="xMidYMid slice" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
    <defs>
      <!-- thresholding / gooey filter -->
      <filter id="metablur" x="-20%" y="-20%" width="140%" height="140%">
        <feGaussianBlur in="SourceGraphic" stdDeviation="30" result="blur"/>
        <!-- amplify alpha and threshold -->
        <feColorMatrix in="blur" mode="matrix" result="cm"
          values="1 0 0 0 0
                  0 1 0 0 0
                  0 0 1 0 0
                  0 0 0 20 -8"/>
        <feComposite in="SourceGraphic" in2="cm" operator="atop"/>
      </filter>

      <!-- Radial gradients for platform themes (we will toggle fill via JS) -->
      <radialGradient id="g_tiktok_1" cx="30%" cy="30%"><stop offset="0%" stop-color="#00f2ea"/><stop offset="100%" stop-color="#ff0066"/></radialGradient>
      <radialGradient id="g_tiktok_2" cx="60%" cy="60%"><stop offset="0%" stop-color="#ff0066"/><stop offset="100%" stop-color="#00f2ea"/></radialGradient>

      <radialGradient id="g_yt_1" cx="30%" cy="30%"><stop offset="0%" stop-color="#ff3b3b"/><stop offset="100%" stop-color="#ff0000"/></radialGradient>
      <radialGradient id="g_yt_2" cx="60%" cy="60%"><stop offset="0%" stop-color="#ff8a4d"/><stop offset="100%" stop-color="#ff0000"/></radialGradient>

      <radialGradient id="g_ig_1" cx="20%" cy="40%"><stop offset="0%" stop-color="#feda75"/><stop offset="100%" stop-color="#d62976"/></radialGradient>
      <radialGradient id="g_ig_2" cx="70%" cy="60%"><stop offset="0%" stop-color="#9b59b6"/><stop offset="100%" stop-color="#d62976"/></radialGradient>
    </defs>

    <g id="metaGroup" class="metagroup" filter="url(#metablur)">
      <!-- 15 metaballs (circles). JS will set cx,cy & radii & fills dynamically -->
      <circle class="metaball" id="mb0" r="220" cx="200" cy="140"/>
      <circle class="metaball" id="mb1" r="260" cx="420" cy="160"/>
      <circle class="metaball" id="mb2" r="210" cx="700" cy="120"/>
      <circle class="metaball" id="mb3" r="300" cx="960" cy="180"/>
      <circle class="metaball" id="mb4" r="240" cx="1220" cy="120"/>
      <circle class="metaball" id="mb5" r="280" cx="1500" cy="160"/>
      <circle class="metaball" id="mb6" r="320" cx="180" cy="420"/>
      <circle class="metaball" id="mb7" r="300" cx="420" cy="420"/>
      <circle class="metaball" id="mb8" r="260" cx="680" cy="420"/>
      <circle class="metaball" id="mb9" r="300" cx="960" cy="460"/>
      <circle class="metaball" id="mb10" r="280" cx="1220" cy="420"/>
      <circle class="metaball" id="mb11" r="260" cx="1500" cy="420"/>
      <circle class="metaball" id="mb12" r="320" cx="400" cy="760"/>
      <circle class="metaball" id="mb13" r="300" cx="960" cy="820"/>
      <circle class="metaball" id="mb14" r="340" cx="1520" cy="760"/>
    </g>
  </svg>

  <!-- =====================
       Your page content (kept intact)
       ===================== -->
  <img src="/static/Longlinemedialogotransparent.png" alt="LongLine Media Logo" id="logo">
  <h1>🎬 TikTok & YouTube Viral Optimizer</h1>

  <div>
    <label for="platform">Select Platform:</label><br />
    <select id="platform" aria-label="Select Platform">
      <option value="TikTok">TikTok</option>
      <option value="YouTube">YouTube</option>
      <option value="Instagram">Instagram</option>
    </select>
  </div>

  <div class="upload-container" id="video-dropzone" role="region" aria-label="Video upload">
    <p class="upload-hint">🎬 Drag and drop your video here or click to upload</p>
    <input type="file" id="video" accept="video/*" />
    <label for="video">Choose a video</label>
    <p id="video-filename" class="file-meta"></p>
    <p id="video-uploaded-time" class="file-meta" style="font-size:.85rem;color:var(--muted)"></p>
  </div>

  <div class="upload-container" id="csv-dropzone" role="region" aria-label="CSV upload">
    <p class="upload-hint">📄 Upload your CSV data (optional)</p>
    <input type="file" id="csv" accept=".csv" />
    <label for="csv">Choose a CSV</label>
    <p id="csv-filename" class="file-meta"></p>
    <p id="csv-uploaded-time" class="file-meta" style="font-size:.85rem;color:var(--muted)"></p>
  </div>

  <button id="analyze-btn" aria-label="Analyze">Analyze</button>

  <div class="loader" id="loader" aria-hidden="true">
    <div class="status-feed" id="statusFeed">Ready</div>
    <div class="progress-wrap" id="progressWrap" aria-hidden="true">
      <div class="progress" id="progressBar"></div>
      <div class="progress-bar-glow" id="progressGlow"></div>
    </div>
    <div class="dots" aria-hidden="true">
      <span class="dot"></span><span class="dot"></span><span class="dot"></span>
    </div>
  </div>

  <div id="detected" class="detected-section" aria-live="polite">
    <h3>🤖 Auto-Detected Video Attributes</h3>
    <p><strong>Niche:</strong> <span id="niche">N/A</span></p>
    <p><strong>Tone:</strong> <span id="tone">N/A</span></p>
    <p><strong>Keywords:</strong> <span id="keywords">None detected</span></p>
  </div>

  <div id="results" aria-live="polite"></div>
  <button id="reset-btn">🔄 New Analysis</button>

  <script>
    /********************************************************
     * Metaball animation & theme wiring
     * - Moves circle cx/cy in JS for smooth, controllable motion
     * - Colors are applied via gradients defined in the SVG defs
     * - Group fades in on load
     ********************************************************/

    const metaGroup = document.getElementById('metaGroup');
    const circles = [];
    for(let i=0;i<15;i++) circles.push(document.getElementById('mb'+i));

    // initial logical positions (percent-based, easier responsive mapping)
    const baseLayout = [
      {xPerc:10,yPerc:6, r:220},
      {xPerc:22,yPerc:8, r:260},
      {xPerc:36,yPerc:6, r:210},
      {xPerc:50,yPerc:8, r:300},
      {xPerc:64,yPerc:7, r:240},
      {xPerc:78,yPerc:8, r:280},
      {xPerc:12,yPerc:36, r:320},
      {xPerc:28,yPerc:38, r:300},
      {xPerc:44,yPerc:36, r:260},
      {xPerc:56,yPerc:42, r:300},
      {xPerc:70,yPerc:38, r:280},
      {xPerc:84,yPerc:38, r:260},
      {xPerc:20,yPerc:72, r:320},
      {xPerc:50,yPerc:82, r:300},
      {xPerc:80,yPerc:72, r:340}
    ];

    // internal state for the animation
    const state = [];
    for(let i=0;i<15;i++){
      const s = baseLayout[i];
      state.push({
        x: window.innerWidth * s.xPerc/100,
        y: window.innerHeight * s.yPerc/100,
        r: s.r,
        phase: Math.random()*Math.PI*2,
        speed: 0.0009 + Math.random()*0.0012,
        amp: 18 + Math.random()*120
      });
    }

    // set circle radii & initial positions
    function applyPositions(){
      const vw = window.innerWidth;
      const vh = window.innerHeight;
      for(let i=0;i<15;i++){
        const s = state[i];
        // ensure r scales a little with viewport
        const r = s.r * Math.min(1, Math.max(0.6, vw/1600));
        circles[i].setAttribute('r', r);
        // set cx/cy
        circles[i].setAttribute('cx', s.x);
        circles[i].setAttribute('cy', s.y);
      }
    }

    // animate positions using requestAnimationFrame for smoothness
    let last = performance.now();
    function animateMetaballs(now){
      const dt = (now - last);
      last = now;
      for(let i=0;i<15;i++){
        const s = state[i];
        s.phase += s.speed * dt;
        // base motion (circular-ish) with varying amplitude to create slow float
        const dx = Math.cos(s.phase * (0.8 + i*0.01)) * s.amp;
        const dy = Math.sin(s.phase * (0.9 + i*0.012)) * (s.amp*0.7);
        // update target positions slightly around original base position (derived from percents)
        const base = baseLayout[i];
        s.x = window.innerWidth * base.xPerc/100 + dx;
        s.y = window.innerHeight * base.yPerc/100 + dy;
        circles[i].setAttribute('cx', s.x);
        circles[i].setAttribute('cy', s.y);
      }
      requestAnimationFrame(animateMetaballs);
    }

    // slight mouse parallax increases on hover (adds to positions)
    let mouseX = 0, mouseY = 0;
    document.addEventListener('mousemove', (e)=>{
      const nx = (e.clientX / window.innerWidth - 0.5);
      const ny = (e.clientY / window.innerHeight - 0.5);
      mouseX = nx; mouseY = ny;
      // apply small immediate offset to states for more interactive feel
      for(let i=0;i<15;i++){
        const bias = (i%3 - 1) * 12; // -12,0,12 pattern
        state[i].x += nx * bias;
        state[i].y += ny * bias;
      }
    });

    // fade-in the group
    setTimeout(()=> metaGroup.classList.add('visible'), 200);

    // responsive: recalc base positions when resizing
    window.addEventListener('resize', ()=>{
      for(let i=0;i<15;i++){
        const base = baseLayout[i];
        state[i].x = window.innerWidth * base.xPerc/100;
        state[i].y = window.innerHeight * base.yPerc/100;
      }
      applyPositions();
    });

    // theme fill application using SVG gradients defined in defs
    function applyTheme(platform){
      const p = platform.toLowerCase();
      if(p==='tiktok'){
        // assign alternating gradients for depth
        for(let i=0;i<15;i++){
          const fill = (i%2===0)? 'url(#g_tiktok_1)':'url(#g_tiktok_2)';
          circles[i].setAttribute('fill', fill);
        }
      } else if(p==='youtube'){
        for(let i=0;i<15;i++){
          const fill = (i%2===0)? 'url(#g_yt_1)':'url(#g_yt_2)';
          circles[i].setAttribute('fill', fill);
        }
      } else { // instagram
        for(let i=0;i<15;i++){
          const fill = (i%2===0)? 'url(#g_ig_1)':'url(#g_ig_2)';
          circles[i].setAttribute('fill', fill);
        }
      }
    }

    // start animation
    applyPositions();
    applyTheme('TikTok');
    requestAnimationFrame(animateMetaballs);

    /********************************************************
     * Front-end UI behavior (drag/drop, show filenames/timestamps,
     * analyze button, loader/progress, parse server response)
     ********************************************************/

    const videoInput = document.getElementById('video');
    const csvInput = document.getElementById('csv');
    const videoFilename = document.getElementById('video-filename');
    const csvFilename = document.getElementById('csv-filename');
    const videoTime = document.getElementById('video-uploaded-time');
    const csvTime = document.getElementById('csv-uploaded-time');
    const analyzeBtn = document.getElementById('analyze-btn');
    const loader = document.getElementById('loader');
    const statusFeed = document.getElementById('statusFeed');
    const progressBar = document.getElementById('progressBar');
    const resultsDiv = document.getElementById('results');
    const detectedDiv = document.getElementById('detected');
    const nicheEl = document.getElementById('niche');
    const toneEl = document.getElementById('tone');
    const keywordsEl = document.getElementById('keywords');
    const resetBtn = document.getElementById('reset-btn');

    // Dropzone handler utility
    function setupDropzone(containerId, inputEl, nameEl, timeEl){
      const zone = document.getElementById(containerId);
      zone.addEventListener('dragover', e => { e.preventDefault(); zone.style.borderColor='rgba(255,255,255,0.18)'; });
      zone.addEventListener('dragleave', e => { zone.style.borderColor=''; });
      zone.addEventListener('drop', e => {
        e.preventDefault(); zone.style.borderColor='';
        const f = e.dataTransfer.files && e.dataTransfer.files[0];
        if(!f) return;
        const dt = new DataTransfer(); dt.items.add(f); inputEl.files = dt.files;
        nameEl.textContent = `Uploaded: ${f.name}`; timeEl.textContent = `Uploaded at ${new Date().toLocaleString()}`;
      });
      inputEl.addEventListener('change', ()=>{
        if(inputEl.files.length>0){
          const f = inputEl.files[0];
          nameEl.textContent = `Uploaded: ${f.name}`; timeEl.textContent = `Uploaded at ${new Date().toLocaleString()}`;
        } else { nameEl.textContent=''; timeEl.textContent=''; }
      });
    }
    setupDropzone('video-dropzone', videoInput, videoFilename, videoTime);
    setupDropzone('csv-dropzone', csvInput, csvFilename, csvTime);

    // loader logic (progress + cycling statuses)
    let feedInterval, progressInterval;
    function startLoaderCycle(){
      loader.style.display='block';
      progressBar.style.width='2%';
      const messages = [
        '🔍 Extracting video metadata...',
        '🎨 Detecting tone, visuals & keywords...',
        '🧠 Analyzing engagement potential...',
        '📊 Comparing with viral examples...',
        '💡 Generating captions, tags & insights...'
      ];
      let mi=0; statusFeed.textContent = messages[mi];
      feedInterval = setInterval(()=>{ mi=(mi+1)%messages.length; statusFeed.textContent = messages[mi]; },1600);
      let progress=2;
      progressInterval = setInterval(()=>{ progress += 3 + Math.random()*6; if(progress>96) progress=96; progressBar.style.width = progress + '%'; },500);
    }
    function stopLoaderCycle(){
      clearInterval(feedInterval); clearInterval(progressInterval);
      progressBar.style.width = '100%';
      setTimeout(()=>{ loader.style.display='none'; progressBar.style.width='0%'; },450);
    }

    analyzeBtn.addEventListener('click', async ()=>{
      const v = videoInput.files[0];
      const c = csvInput.files[0];
      const platform = document.getElementById('platform').value;
      if(!v){ alert('Please upload a video file first.'); return; }

      // UI prep
      detectedDiv.classList.remove('visible');
      resultsDiv.textContent = `🎥 Running ${platform} Viral Optimizer...\n\n🤖 Generating AI-powered analysis...`;
      analyzeBtn.disabled=true; analyzeBtn.style.opacity=.6;
      startLoaderCycle();

      const fd = new FormData(); fd.append('video', v); fd.append('platform', platform); if(c) fd.append('csv', c);

      try{
        const res = await fetch('/analyze',{ method:'POST', body: fd });
        const data = await res.json();
        stopLoaderCycle();
        analyzeBtn.disabled=false; analyzeBtn.style.opacity=1;

        if(data.error){
          resultsDiv.textContent = '❌ ' + data.error; return;
        }

        const resultText = data.result || data.ai_results || (data.analysis? JSON.stringify(data.analysis,null,2) : JSON.stringify(data,null,2));

        // attempt to extract detected attributes for the small detected pane
        const nicheMatch = resultText.match(/Detected Niche:\s*\*\*(.+?)\*\*/i) ||
                           resultText.match(/- Niche:\s*(.+)/i) ||
                           resultText.match(/Niche:\s*(.+)/i);
        const toneMatch = resultText.match(/Tone:\s*(.+)/i);
        const keywordsMatch = resultText.match(/Keywords?:\s*(.+)/i);

        if(nicheMatch || toneMatch || keywordsMatch){
          detectedDiv.style.display='block';
          setTimeout(()=> detectedDiv.classList.add('visible'),80);
          nicheEl.textContent = nicheMatch ? (nicheMatch[1]||nicheMatch[0]).trim() : 'N/A';
          toneEl.textContent = toneMatch ? toneMatch[1].trim() : 'N/A';
          keywordsEl.textContent = keywordsMatch ? keywordsMatch[1].trim() : 'None detected';
        }

        setTimeout(()=>{ resultsDiv.textContent = resultText; document.getElementById('reset-btn').style.display='inline-block'; analyzeBtn.style.display='none'; }, 350);
      } catch(err){
        stopLoaderCycle(); analyzeBtn.disabled=false; analyzeBtn.style.opacity=1;
        resultsDiv.textContent = '⚠️ Error processing request: ' + (err.message || err);
        console.error(err);
      }
    });

    document.getElementById('reset-btn').addEventListener('click', ()=>{
      resultsDiv.textContent=''; document.getElementById('video-filename').textContent=''; document.getElementById('csv-filename').textContent='';
      document.getElementById('video-uploaded-time').textContent=''; document.getElementById('csv-uploaded-time').textContent='';
      document.getElementById('video').value=''; document.getElementById('csv').value='';
      document.getElementById('detected').classList.remove('visible');
      document.getElementById('reset-btn').style.display='none';
      document.getElementById('analyze-btn').style.display='inline-block';
    });

    // platform change wiring: body classes + theme application to metaballs + loader dot colors
    const platformSelect = document.getElementById('platform');
    platformSelect.addEventListener('change', (e)=>{
      const val = e.target.value;
      body.classList.remove('tiktok-mode','youtube-mode','instagram-mode');
      if(val==='TikTok') body.classList.add('tiktok-mode');
      if(val==='YouTube') body.classList.add('youtube-mode');
      if(val==='Instagram') body.classList.add('instagram-mode');
      applyTheme(val);
      // update loader dots colors quickly
      const dots = document.querySelectorAll('.dot');
      if(val==='TikTok') { dots.forEach((d,i)=> d.style.background = (i%2? 'var(--tiktok-b)':'var(--tiktok-a)')); }
      if(val==='YouTube') { dots.forEach(d=> d.style.background = 'var(--yt-a)'); }
      if(val==='Instagram') { dots.forEach((d,i)=> d.style.background = (i%2? 'var(--ig-a)':'var(--ig-b)')); }
    });

    // applyTheme uses SVG gradient ids previously defined
    function applyTheme(platform){
      const p = platform.toLowerCase();
      if(p==='tiktok'){
        for(let i=0;i<15;i++) circles[i].setAttribute('fill', (i%2? 'url(#g_tiktok_2)':'url(#g_tiktok_1)') );
      } else if(p==='youtube'){
        for(let i=0;i<15;i++) circles[i].setAttribute('fill', (i%2? 'url(#g_yt_2)':'url(#g_yt_1)') );
      } else {
        for(let i=0;i<15;i++) circles[i].setAttribute('fill', (i%2? 'url(#g_ig_2)':'url(#g_ig_1)') );
      }
    }

    // initial theme setup
    applyTheme('TikTok');

    // accessibility: allow keyboard activation of file labels
    document.querySelectorAll('label[for]').forEach(l=>{
      l.addEventListener('keydown', e=>{
        if(e.key==='Enter' || e.key===' ') {
          const id = l.getAttribute('for'); const el = document.getElementById(id); if(el) el.click();
        }
      });
    });

    // ensure metaGroup visible once first animation tick is set (tiny delay)
    setTimeout(()=> metaGroup.classList.add('visible'), 250);
  </script>
</body>
</html>
