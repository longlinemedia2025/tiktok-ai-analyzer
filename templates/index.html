<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Viral Analyzer â€“ TikTok & YouTube</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800 font-sans min-h-screen flex flex-col items-center p-6">
  <div class="max-w-3xl w-full bg-white rounded-2xl shadow-lg p-8">
    <h1 class="text-3xl font-bold text-center mb-2">ğŸ¬ Viral Video Analyzer</h1>
    <p class="text-center text-gray-600 mb-6">
      Upload your video and optional CSV for AI-powered optimization insights.
    </p>

    <!-- Platform Selection -->
    <label class="block text-gray-700 font-semibold mb-1">Platform</label>
    <select id="platform" class="w-full border rounded-lg p-2 mb-4 focus:ring-2 focus:ring-indigo-400">
      <option value="tiktok">TikTok</option>
      <option value="youtube">YouTube</option>
    </select>

    <!-- File Uploads -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-indigo-400 transition">
        <input type="file" id="video" accept="video/*" class="hidden" />
        <label for="video" class="cursor-pointer text-indigo-600 font-semibold">ğŸ¥ Upload Video</label>
        <p id="video-name" class="mt-2 text-sm text-gray-500">No file chosen</p>
      </div>

      <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-indigo-400 transition">
        <input type="file" id="csv" accept=".csv" class="hidden" />
        <label for="csv" class="cursor-pointer text-indigo-600 font-semibold">ğŸ“Š Upload CSV (optional)</label>
        <p id="csv-name" class="mt-2 text-sm text-gray-500">No file chosen</p>
      </div>
    </div>

    <!-- Keyword, Tone, Niche Inputs -->
    <div class="mt-6">
      <label class="block text-gray-700 font-semibold mb-1">Keywords (comma separated)</label>
      <input id="keywords" class="w-full border rounded-lg p-2 mb-3" placeholder="haircut, transformation, fade" />

      <label class="block text-gray-700 font-semibold mb-1">Tone</label>
      <input id="tone" class="w-full border rounded-lg p-2 mb-3" placeholder="energetic, funny, inspiring" />

      <label class="block text-gray-700 font-semibold mb-1">Niche</label>
      <input id="niche" class="w-full border rounded-lg p-2" placeholder="beauty, gaming, fitness, etc." />
    </div>

    <!-- Analyze Button -->
    <div class="mt-6 text-center">
      <button id="analyze-btn" class="bg-indigo-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-indigo-700 transition">
        ğŸ” Analyze
      </button>
    </div>

    <!-- Loading Spinner -->
    <div id="loading" class="hidden mt-6 text-center">
      <div class="animate-spin rounded-full h-10 w-10 border-t-4 border-indigo-600 mx-auto"></div>
      <p class="mt-2 text-gray-600">Analyzing your videoâ€¦ please wait.</p>
    </div>

    <!-- Results -->
    <div id="results" class="mt-8 whitespace-pre-line bg-gray-50 p-4 rounded-lg border hidden"></div>
  </div>

  <script>
    const videoInput = document.getElementById("video");
    const csvInput = document.getElementById("csv");
    const videoName = document.getElementById("video-name");
    const csvName = document.getElementById("csv-name");
    const analyzeBtn = document.getElementById("analyze-btn");
    const resultsDiv = document.getElementById("results");
    const loadingDiv = document.getElementById("loading");

    // Show uploaded filenames
    videoInput.addEventListener("change", () => {
      videoName.textContent = videoInput.files.length ? videoInput.files[0].name : "No file chosen";
    });
    csvInput.addEventListener("change", () => {
      csvName.textContent = csvInput.files.length ? csvInput.files[0].name : "No file chosen";
    });

    analyzeBtn.addEventListener("click", async () => {
      const platform = document.getElementById("platform").value;
      const keywords = document.getElementById("keywords").value;
      const tone = document.getElementById("tone").value;
      const niche = document.getElementById("niche").value;
      const video = videoInput.files[0];
      const csv = csvInput.files[0];

      if (!video) {
        alert("Please upload a video first!");
        return;
      }

      const formData = new FormData();
      formData.append("platform", platform);
      formData.append("keywords", keywords);
      formData.append("tone", tone);
      formData.append("niche", niche);
      formData.append("video", video);
      if (csv) formData.append("csv", csv);

      loadingDiv.classList.remove("hidden");
      resultsDiv.classList.add("hidden");
      resultsDiv.textContent = "";

      try {
        const response = await fetch("/analyze", {
          method: "POST",
          body: formData
        });
        const data = await response.json();

        if (data.status === "success") {
          const res = data.results;
          const platformLabel = res.platform === "tiktok" ? "TikTok" : "YouTube";
          const baseFormat = `
ğŸ¬ Drag and drop your ${platformLabel} video file here: "${res.video}"
ğŸ¥ Running ${platformLabel} Viral Optimizer...

ğŸ”¥ Fetching viral video comparisons and strategic insights...

âœ… ${platformLabel} Video Analysis Complete!

ğŸ¬ Video: ${res.video}
ğŸ“ Duration: ${res.meta.duration_seconds}s
ğŸ–¼ Resolution: ${res.meta.resolution[0]}x${res.meta.resolution[1]}
ğŸ“± Aspect Ratio: ${res.meta.aspect_ratio}
ğŸ’¡ Brightness: ${res.meta.mean_brightness_first_frame}
â­ Heuristic Score: ${res.meta.heuristics.normalized_0_10}/10 (${res.meta.heuristics.notes.join(" ")})

ğŸ’¬ AI-Generated ${platformLabel} Insights:
${res.ai_insights}

${res.csv_used ? "ğŸ“ˆ CSV data included in analysis." : ""}
ğŸ“… Timestamp: ${res.timestamp}
`;
          resultsDiv.textContent = baseFormat;
          resultsDiv.classList.remove("hidden");
        } else {
          resultsDiv.textContent = "âš ï¸ Error: " + data.error;
          resultsDiv.classList.remove("hidden");
        }
      } catch (err) {
        resultsDiv.textContent = "âŒ Failed to analyze video. " + err;
        resultsDiv.classList.remove("hidden");
      } finally {
        loadingDiv.classList.add("hidden");
      }
    });
  </script>
</body>
</html>
