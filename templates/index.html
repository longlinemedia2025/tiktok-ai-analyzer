<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LongLine Media Viral Optimizer</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="tiktok-theme">
  <div class="container">
    <img src="{{ url_for('static', filename='Longlinemedialogotransparent.png') }}" alt="LongLine Media Logo" class="logo">
    <h1>ðŸŽ¬ TikTok, YouTube & Instagram Viral Optimizer</h1>

    <!-- Platform selector -->
    <label for="platform">Select Platform:</label><br />
    <select id="platform">
      <option value="TikTok">TikTok</option>
      <option value="YouTube">YouTube</option>
      <option value="Instagram">Instagram</option>
    </select>

    <!-- Video upload -->
    <div class="upload-container" id="video-dropzone">
      <p>ðŸŽ¬ Drag & drop your video here or click to upload</p>
      <input type="file" id="video" accept="video/*" />
      <label for="video">Choose a video</label>
      <p id="video-filename"></p>
    </div>

    <!-- CSV upload -->
    <div class="upload-container" id="csv-dropzone">
      <p>ðŸ“„ Upload your CSV data (optional)</p>
      <input type="file" id="csv" accept=".csv" />
      <label for="csv">Choose a CSV</label>
      <p id="csv-filename"></p>
    </div>

    <!-- Analyze button -->
    <button id="analyze-btn">Analyze</button>
    <div id="glow-bar"></div>

    <!-- Loading -->
    <div class="loading-section hidden" id="loader">
      <p id="loader-text">Initializing AI analysis...</p>
    </div>

    <!-- Detected attributes -->
    <div id="detected" class="hidden">
      <h3>ðŸ¤– Auto-Detected Video Attributes</h3>
      <p><strong>Niche:</strong> <span id="niche"></span></p>
      <p><strong>Tone:</strong> <span id="tone"></span></p>
      <p><strong>Keywords:</strong> <span id="keywords"></span></p>
    </div>

    <!-- Results -->
    <div id="result-card" class="hidden">
      <pre id="results"></pre>
    </div>

    <!-- Reset -->
    <button id="reset-btn" class="hidden">ðŸ”„ New Analysis</button>
  </div>

  <script>
    const videoInput = document.getElementById("video");
    const csvInput = document.getElementById("csv");
    const videoFilename = document.getElementById("video-filename");
    const csvFilename = document.getElementById("csv-filename");
    const analyzeBtn = document.getElementById("analyze-btn");
    const resetBtn = document.getElementById("reset-btn");
    const resultsDiv = document.getElementById("results");
    const detectedDiv = document.getElementById("detected");
    const loader = document.getElementById("loader");
    const loaderText = document.getElementById("loader-text");
    const glowBar = document.getElementById("glow-bar");
    const platformSelect = document.getElementById("platform");

    /* ===== FILE NAME DISPLAY ===== */
    videoInput.addEventListener("change", () => {
      videoFilename.textContent = videoInput.files.length ? `ðŸ“¹ ${videoInput.files[0].name}` : "";
    });
    csvInput.addEventListener("change", () => {
      csvFilename.textContent = csvInput.files.length ? `ðŸ“„ ${csvInput.files[0].name}` : "";
    });

    /* ===== DRAG & DROP ===== */
    function setupDropZone(dropzone, input, label) {
      dropzone.addEventListener("dragover", e => {
        e.preventDefault();
        dropzone.classList.add("dragover");
      });
      dropzone.addEventListener("dragleave", () => dropzone.classList.remove("dragover"));
      dropzone.addEventListener("drop", e => {
        e.preventDefault();
        dropzone.classList.remove("dragover");
        input.files = e.dataTransfer.files;
        label.textContent = `âœ… ${e.dataTransfer.files[0].name} uploaded`;
      });
    }
    setupDropZone(document.getElementById("video-dropzone"), videoInput, videoFilename);
    setupDropZone(document.getElementById("csv-dropzone"), csvInput, csvFilename);

    /* ===== PLATFORM COLOR SWITCH ===== */
    platformSelect.addEventListener("change", () => {
      document.body.classList.remove("tiktok-theme", "youtube-theme", "instagram-theme");
      document.body.classList.add(`${platformSelect.value.toLowerCase()}-theme`);
    });

    /* ===== ANALYZE BUTTON ===== */
    analyzeBtn.addEventListener("click", async () => {
      const video = videoInput.files[0];
      if (!video) {
        alert("Please upload a video before analyzing.");
        return;
      }

      document.body.classList.add("active-analyzing");
      glowBar.classList.add("active");
      loader.classList.remove("hidden");
      loaderText.textContent = "ðŸŽ¥ Running analysis...";
      analyzeBtn.disabled = true;

      const formData = new FormData();
      formData.append("video", video);
      if (csvInput.files[0]) formData.append("csv", csvInput.files[0]);
      formData.append("platform", platformSelect.value);

      try {
        const response = await fetch("/analyze", { method: "POST", body: formData });
        const data = await response.json();

        loader.classList.add("hidden");
        glowBar.classList.remove("active");
        document.body.classList.remove("active-analyzing");

        detectedDiv.classList.remove("hidden");
        document.getElementById("niche").textContent = data.niche || "Auto-detected niche";
        document.getElementById("tone").textContent = data.tone || "Auto-detected tone";
        document.getElementById("keywords").textContent = data.keywords || "Auto-detected keywords";

        resultsDiv.textContent = data.analysis || "No analysis returned.";
        document.getElementById("result-card").classList.remove("hidden");
        resetBtn.classList.remove("hidden");
      } catch (err) {
        alert("Error analyzing video. Please try again.");
        loader.classList.add("hidden");
        glowBar.classList.remove("active");
        document.body.classList.remove("active-analyzing");
      }
    });

    /* ===== RESET BUTTON ===== */
    resetBtn.addEventListener("click", () => {
      videoInput.value = "";
      csvInput.value = "";
      videoFilename.textContent = "";
      csvFilename.textContent = "";
      resultsDiv.textContent = "";
      loader.classList.add("hidden");
      document.getElementById("result-card").classList.add("hidden");
      detectedDiv.classList.add("hidden");
      resetBtn.classList.add("hidden");
      analyzeBtn.disabled = false;
    });
  </script>
</body>
</html>
